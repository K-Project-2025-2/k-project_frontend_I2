# API 연동 테스트 가이드

## 실행 전 확인사항

### 1. 백엔드 서버 상태 확인
백엔드 서버가 실행 중인지 확인하세요:
- Swagger 문서 접속: http://3.36.32.57:8080/swagger-ui/index.html
- Health Check: http://3.36.32.57:8080/api/health

### 2. 네트워크 연결 확인
- 모바일 기기/에뮬레이터에서 백엔드 서버에 접근 가능한지 확인
- 같은 네트워크에 있는지 확인 (로컬 개발 환경인 경우)

### 3. 필수 패키지 설치 확인
```bash
npm install
```

## 실행 방법

### 개발 서버 시작
```bash
npm start
# 또는
npx expo start
```

### 플랫폼별 실행
- **Android**: `npm run android` 또는 Expo Go 앱에서 QR 코드 스캔
- **iOS**: `npm run ios` 또는 Expo Go 앱에서 QR 코드 스캔
- **Web**: `npm run web`

## 테스트 시나리오

### 1. 회원가입 테스트
1. 앱 실행 → 회원가입 화면 이동
2. 이름, 학번, 이메일 입력
3. "인증요청" 버튼 클릭 → 이메일 인증 코드 발송 확인
4. 인증번호 입력 후 "인증확인" 클릭
5. 비밀번호 입력 후 "회원가입" 클릭
6. 성공 시 로그인 화면으로 이동

**예상 결과:**
- ✅ 성공: 로그인 화면으로 이동
- ❌ 실패: 에러 메시지 표시 (Alert)

### 2. 로그인 테스트
1. 회원가입한 이메일과 비밀번호 입력
2. "로그인" 버튼 클릭
3. 성공 시 메인 화면으로 이동

**예상 결과:**
- ✅ 성공: 메인 화면으로 이동, 토큰이 AsyncStorage에 저장됨
- ❌ 실패: 에러 메시지 표시

### 3. 방 생성 테스트
1. 택시 탭으로 이동
2. "방 생성" 버튼 클릭
3. 출발지, 도착지 선택
4. 인원 수 선택
5. "완료" 버튼 클릭

**예상 결과:**
- ✅ 성공: 방 생성 완료 화면 표시, 채팅방으로 이동
- ❌ 실패: 에러 메시지 표시

### 4. 방 참여 테스트
1. 택시 탭에서 방 목록 확인
2. 방 선택 후 "입장" 클릭
3. 초대코드가 필요한 경우 초대코드 입력

**예상 결과:**
- ✅ 성공: 채팅방으로 이동
- ❌ 실패: 에러 메시지 표시 (인원 초과, 방 없음 등)

### 5. 메시지 전송 테스트
1. 채팅방 입장
2. 메시지 입력 후 전송

**예상 결과:**
- ✅ 성공: 메시지가 화면에 표시됨
- ❌ 실패: 에러 메시지 표시, 메시지가 사라짐

### 6. 분실물 신고 테스트
1. 마이페이지 → 분실물 신고
2. 분실물 이름, 상세 설명 입력
3. "신고하기" 클릭

**예상 결과:**
- ✅ 성공: 신고 완료 메시지 표시
- ❌ 실패: 에러 메시지 표시

## 문제 해결

### 1. 네트워크 에러
**증상**: "Network request failed" 에러
**해결책**:
- 백엔드 서버가 실행 중인지 확인
- API_BASE_URL이 올바른지 확인 (`services/apiConfig.js`)
- 방화벽/보안 설정 확인

### 2. 인증 에러 (401 Unauthorized)
**증상**: "로그인 실패" 또는 "인증 필요" 에러
**해결책**:
- 로그인 후 토큰이 제대로 저장되었는지 확인
- 토큰 형식이 올바른지 확인 (Bearer 토큰)
- AsyncStorage에 토큰이 있는지 확인

### 3. CORS 에러 (웹에서 실행 시)
**증상**: CORS 관련 에러
**해결책**:
- 백엔드에서 CORS 설정 확인
- 모바일 앱에서 실행 (웹 대신)

### 4. API 응답 형식 불일치
**증상**: 데이터가 제대로 표시되지 않음
**해결책**:
- Swagger 문서와 실제 응답 형식 비교
- 콘솔 로그로 응답 데이터 확인
- `services/taxiApi.js`, `services/authApi.js`의 응답 파싱 로직 확인

## 디버깅 팁

### 1. 콘솔 로그 확인
개발자 도구나 터미널에서 API 호출 로그 확인:
```javascript
// 각 API 함수에 console.log가 있음
console.error('로그인 에러:', error);
```

### 2. AsyncStorage 확인
토큰이 제대로 저장되었는지 확인:
```javascript
// React Native Debugger 또는 개발자 도구에서
AsyncStorage.getItem('@auth_token')
```

### 3. 네트워크 요청 확인
- React Native Debugger 사용
- 또는 백엔드 서버 로그 확인

## 주의사항

1. **Swagger에 없는 API**: 일부 기능(방 목록 조회, 메시지 조회 등)은 아직 백엔드에 추가되지 않아 에러가 발생할 수 있습니다.

2. **에러 처리**: 모든 API 호출에 try-catch가 있으므로 에러 발생 시 Alert로 표시됩니다.

3. **로딩 상태**: API 호출 중에는 버튼이 비활성화되고 로딩 인디케이터가 표시됩니다.

4. **토큰 관리**: 로그인 후 토큰이 자동으로 저장되며, 이후 API 호출 시 자동으로 포함됩니다.

## 다음 단계

백엔드에서 Swagger에 없는 API들을 추가하면 (`docs/SWAGGER_ADD_REQUIRED.md` 참고), 해당 기능들도 연동할 수 있습니다.

